
pachong=false 
if(confirm("确定开始爬虫吗？")){	
	pachong=true;
}

if(pachong){
//初始化工作 
	
var keyword="中国古代文学考研";
//select phone,count(*) as count from telephone  group by phone having count>1;
 

hh="5151358,182182774,119608999";
/*hh="519264237,194950875,1386477619,1377357409,2728780,115024566,60961760,1359248902,165785589,92008293,187198717,1220773,50344806,41572760,42526341,40119776,193938986,151125351,1160130465,158422227,1526456584,62612438,671279606,186084165,894072680,1528486587,1505792472,103264187,156702643,195596601,1664038157,511024659";
hh="646741068,182234333,1750270251,597280784,52509768,187955964,1410016260,171876664,193938085,894072680,1528486587,1505792472,1071240724,103264187,1364702706,85381746,52438168,1973721984,544049284,182988213,959440447,663136546,118072160,167183657,1795182926,180209730,945406053,1666236264,156458236,182850972,192627496,5151358";
hh="162442131,179304664,40115982,1298777427,1963347054,1071240724,103264187,1364702706,577797514,1268103032,85381746,1079025480,1996507054,1999187671,1923310610,1978836680,1694151009,156702643,1222306,195596601,544049284,182988213,959440447,663136546,118072160,167183657,1795182926,180209730,945406053,1666236264,156458236,182850972";
hh="787244422,1526456584,62612438,671279606,901625795,1010240772,1189453061,1534655760,646741068,1750270251,597280784,52509768,187955964,171876664,894072680,1528486587,1505792472,1963347054,103264187,1364702706,85381746,156702643,165277319,40115982,1426082196,164800459,1433018524,1666236264,165472090,194908514,158945582,1760738470";
hh="1298777427,1963347054,103264187,577797514,1268103032,1079025480,1996507054,1999187671,1923310610,1978836680,156702643,195596601,1664038157,511024659,182274979,917394871,118072160,570598272,190068850,778667273,981376771,918146459,189214022,1760738470,702706533,156458236,86030945,5151358,119608999,154811905,191364208";
hh="182088069,771332045,165277319,1426082196,164800459,1433018524,1666236264,156702643,165472090,194908514,158945582,1760738470,103354995,190347409,959440447,182182774,190171990,90556372,1795182926,778667273,981376771,945406053,182850972,86030945,6501108,188738075,186818175,1651851981,41621775,544049284,1664038157,511024659";
hh="114910148,193663662,570598272,1222306,195596601,1232071368,508889090,193938085,186084165,1589878678,118072160,190068850,167183657,918146459,189214022,180209730,702706533,156458236,192627496,91817122,180108917,191507965,154811905,191364208,177497786,1870766233,190409765,191382914,182274979,190999917,187012492,1661744137";
hh="1228407562,114910148,193663662,570598272,1222306,195596601,1232071368,508889090,193938085,186084165,1589878678,118072160,190068850,167183657,918146459,189214022,180209730,702706533,156458236,192627496,91817122,180108917,191507965,154811905,191364208,177497786,1870766233,190409765,191382914,182274979,190999917,187012492";
hh="154811905,191364208,177497786,1870766233,190409765,191382914,182274979,190999917,187012492,1661744137,192012364,156114470,1696575934,108178818,182088069,167710834,1148998756,181015764,182726143,70897001,103264187,1603365044,1655394354,1193077155,1351778319,1630459754,639337835,787244422,1526456584,671279606,901625795";
*/


var hashs=hh.split(",");
var hashi=0;
	
////开始执行
openNewPage(hashi);
	
chrome.runtime.onMessage.addListener(function(request, sender, sendResponse)
{
	
	//console.log(	request.curcon)	
	 
	$.post("http://www.datun.com.cn/bst/setphone.php",{name:request.name,phone:request.phone,detail:"https://www.meituan.com/meishi/"+hashs[hashi]+"/",address:request.address},function(result){
		// alert(result)
		 if(result=="{ \"err\":\"0\" }"){
		 	  
		 		
		 	  console.log(	request.curcon);
		 	  console.log(	"---------------------------------------------");		 	  
      	hashi++;    
      	if(hashi>=hashs.length)  {
      		alert("共完成"+hashi+"条记录");
      		return;
      	}	   	
      	chrome.tabs.remove(sender.tab.id);
				openNewPage(hashi);
      }else{
        alert(hashi+"存储到db错误,第"+(hashi+1)+"条:"+getUrl(hashs[hashi],keyword));
      }
		
		
	})	
	
	
})	
	
//拼接地址
function getUrl(hash_v,kw){
	return "https://www.meituan.com/meishi/"+hash_v+"/";
}	
	
	
//打开新的chrome页面
function openNewPage(i){
	url=getUrl(hashs[i],keyword);
	console.log("正在访问:"+url);
	console.log(	"*******************************************");
	setTimeout(function () {
		chrome.tabs.create({url:url,active:true}, function (tab){});
		
	}, 500);  
}



}//if pachong